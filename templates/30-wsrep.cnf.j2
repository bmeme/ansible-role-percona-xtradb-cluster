{{ ansible_managed | comment }}
[mysqld]
# Galera
wsrep_provider=/usr/lib64/galera4/libgalera_smm.so
wsrep_cluster_name = {{ percona_cluster_name }}
wsrep_node_address = {{ percona_cluster.ip_address }}
wsrep_node_name = {{ inventory_hostname }}

# URL dei peer
wsrep_cluster_address = "gcomm://{{ ip_without_arbiter | join(',' ) }}"

# Requisiti PXC
binlog_format = ROW
innodb_autoinc_lock_mode = 2
wsrep_applier_threads = 8
wsrep_log_conflicts

{% if percona_ssl_enabled | bool %}
# Galera SSL enabled
wsrep_provider_options = "socket.ssl=YES;socket.ssl_ca=ca.pem;socket.ssl_cert=server-cert.pem;socket.ssl_key=server-key.pem;socket.ssl_cipher=AES128-SHA"
{% else %}
# Galera SSL disabled
pxc_encrypt_cluster_traffic=OFF
wsrep_provider_options = "socket.ssl=NO; pc.recovery=true"
{% endif %}

# SST
wsrep_sst_method = xtrabackup-v2

# PXC strict mode
pxc_strict_mode = ENFORCING

[sst]
auth = "{{ percona_sst_user }}:{{ percona_sst_password }}"
